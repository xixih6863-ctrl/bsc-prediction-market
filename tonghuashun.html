<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š åŒèŠ±é¡ºé¢„æµ‹å¸‚åœº - Aè‚¡æœŸè´§æœŸæƒ</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0a0f; color: #fff; font-family: -apple-system, sans-serif; min-height: 100vh; }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #c41e3a 0%, #8b0000 100%);
            padding: 20px 30px;
            border-bottom: 3px solid #ffd700;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .logo { display: flex; align-items: center; gap: 12px; font-size: 26px; font-weight: bold; color: #ffd700; }
        .logo-icon { font-size: 32px; }
        .sub-logo { font-size: 14px; color: rgba(255,255,255,0.8); font-weight: normal; }
        
        /* Wallet */
        .wallet-bar { display: flex; align-items: center; gap: 15px; }
        .wallet-info {
            display: none;
            align-items: center;
            gap: 12px;
            background: rgba(255,215,0,0.15);
            padding: 10px 18px;
            border-radius: 10px;
        }
        .wallet-info.show { display: flex; }
        .wallet-addr { font-size: 13px; color: #ffd700; font-family: monospace; }
        .wallet-bal { font-size: 14px; color: #ffd700; font-weight: bold; }
        .disconnect-btn {
            background: rgba(255,0,0,0.2);
            color: #ff6666;
            padding: 8px 15px;
            border: 1px solid #ff6666;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
        }
        .connect-btn {
            background: linear-gradient(135deg, #ffd700, #ffb700);
            color: #8b0000;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* Container */
        .container { max-width: 1400px; margin: 0 auto; padding: 25px; }
        
        /* Status Bar */
        .status-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }
        .status-card {
            background: linear-gradient(135deg, #1a1a24, #0d0d14);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 18px;
            text-align: center;
        }
        .status-title { font-size: 12px; color: #888; margin-bottom: 8px; }
        .status-value { font-size: 16px; font-weight: bold; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .status-dot.green { background: #22bb33; }
        .status-dot.red { background: #ff4444; }
        .status-dot.yellow { background: #ffd700; }
        .status-dot.gray { background: #666; }
        
        .status-success { color: #22bb33; }
        .status-error { color: #ff4444; }
        .status-warning { color: #ffd700; }
        
        /* Index Bar */
        .index-bar {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin-bottom: 30px;
        }
        .index-card {
            background: linear-gradient(135deg, #1a1a24, #0d0d14);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 18px;
        }
        .index-name { font-size: 12px; color: #888; margin-bottom: 8px; }
        .index-val { font-size: 22px; font-weight: bold; }
        .index-up { color: #ff4444; font-size: 14px; margin-top: 5px; }
        .index-down { color: #22bb33; font-size: 14px; margin-top: 5px; }
        
        /* Section */
        .section { margin-bottom: 35px; }
        .section-title {
            font-size: 22px;
            color: #ffd700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .market-count {
            background: rgba(255,215,0,0.15);
            color: #ffd700;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        /* Category Filter */
        .category-filter { display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; }
        .cat-btn {
            background: #1a1a24;
            border: 1px solid #333;
            padding: 10px 20px;
            border-radius: 25px;
            color: #888;
            cursor: pointer;
        }
        .cat-btn:hover { background: #2a2a3a; }
        .cat-btn.active {
            background: linear-gradient(135deg, #c41e3a, #8b0000);
            border-color: #ffd700;
            color: #ffd700;
        }
        
        /* Market Grid */
        .markets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 18px;
        }
        .market-card {
            background: #111118;
            border: 1px solid #222;
            border-radius: 16px;
            padding: 22px;
        }
        .card-header { display: flex; justify-content: space-between; margin-bottom: 12px; }
        .card-title { font-size: 16px; font-weight: 500; flex: 1; padding-right: 12px; }
        .hot-tag {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: #fff;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
        }
        .card-meta { display: flex; gap: 15px; font-size: 13px; color: #888; margin-bottom: 15px; }
        
        /* Progress Bar */
        .progress-bar { height: 8px; background: #222; border-radius: 4px; overflow: hidden; display: flex; margin: 18px 0; }
        .progress-yes { height: 100%; background: linear-gradient(90deg, #22bb33, #44dd55); }
        .progress-no { height: 100%; background: linear-gradient(90deg, #ff6666, #ff4444); }
        .progress-labels { display: flex; justify-content: space-between; font-size: 12px; color: #666; margin-bottom: 15px; }
        
        /* Odds Buttons */
        .odds-section { display: flex; gap: 12px; margin-top: 18px; }
        .odds-btn {
            flex: 1;
            padding: 16px 12px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .odds-btn:hover { transform: translateY(-2px); }
        .odds-up {
            background: rgba(34,187,51,0.15);
            border-color: rgba(34,187,51,0.4);
            color: #22bb33;
        }
        .odds-down {
            background: rgba(255,68,68,0.15);
            border-color: rgba(255,68,68,0.4);
            color: #ff4444;
        }
        .odds-label { font-size: 14px; margin-bottom: 6px; font-weight: 500; }
        .odds-value { font-size: 24px; font-weight: bold; }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            font-size: 13px;
            margin-top: 40px;
            border-top: 1px solid #222;
        }
        .footer a { color: #ffd700; text-decoration: none; }
        
        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-overlay.show { display: flex; }
        .modal {
            background: #1a1a24;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
        }
        .modal-title { font-size: 20px; color: #ffd700; margin-bottom: 20px; }
        .modal-input {
            width: 100%;
            padding: 14px;
            background: #0d0d14;
            border: 1px solid #333;
            border-radius: 10px;
            color: #fff;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .modal-btns { display: flex; gap: 12px; }
        .modal-btn {
            flex: 1;
            padding: 14px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
        }
        .modal-btn.confirm { background: linear-gradient(135deg, #22bb33, #119922); color: #fff; }
        .modal-btn.cancel { background: #333; color: #888; }
        
        @media (max-width: 768px) {
            .markets-grid { grid-template-columns: 1fr; }
            .index-bar { grid-template-columns: repeat(2, 1fr); }
            .status-bar { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <span class="logo-icon">ğŸ“Š</span>
            <div>
                <div>åŒèŠ±é¡ºé¢„æµ‹å¸‚åœº</div>
                <div class="sub-logo">Aè‚¡ Â· æœŸè´§ Â· æœŸæƒ Â· æ¸¯è‚¡</div>
            </div>
        </div>
        <div class="wallet-bar">
            <div class="wallet-info" id="walletInfo">
                <span class="wallet-addr" id="walletAddr">---</span>
                <span class="wallet-bal" id="walletBal">0 BNB</span>
                <button class="disconnect-btn" onclick="disconnectWallet()">æ–­å¼€</button>
            </div>
            <button class="connect-btn" id="connectBtn" onclick="connectWallet()">ğŸ”— è¿æ¥é’±åŒ…</button>
        </div>
    </div>
    
    <div class="container">
        <!-- Status -->
        <div class="status-bar">
            <div class="status-card">
                <div class="status-title">MetaMask</div>
                <div class="status-value" id="metamaskStatus"><span class="status-dot gray"></span>æ£€æµ‹ä¸­...</div>
            </div>
            <div class="status-card">
                <div class="status-title">ç½‘ç»œ</div>
                <div class="status-value" id="networkStatus"><span class="status-dot gray"></span>æ£€æµ‹ä¸­...</div>
            </div>
            <div class="status-card">
                <div class="status-title">åˆçº¦</div>
                <div class="status-value" id="contractStatus"><span class="status-dot gray"></span>æ£€æµ‹ä¸­...</div>
            </div>
            <div class="status-card">
                <div class="status-title">è¿æ¥çŠ¶æ€</div>
                <div class="status-value" id="connectionStatus"><span class="status-dot gray"></span>æœªè¿æ¥</div>
            </div>
        </div>
        
        <!-- A-Share Indices -->
        <div class="section">
            <div class="section-title">ğŸ“ˆ Aè‚¡æŒ‡æ•°</div>
            <div class="index-bar">
                <div class="index-card"><div class="index-name">ä¸Šè¯æŒ‡æ•°</div><div class="index-val">3,452.31</div><div class="index-up">+1.23%</div></div>
                <div class="index-card"><div class="index-name">æ·±è¯æˆæŒ‡</div><div class="index-val">11,892.45</div><div class="index-down">-0.45%</div></div>
                <div class="index-card"><div class="index-name">åˆ›ä¸šæ¿æŒ‡</div><div class="index-val">2,456.78</div><div class="index-up">+0.89%</div></div>
                <div class="index-card"><div class="index-name">æ²ªæ·±300</div><div class="index-val">4,123.56</div><div class="index-up">+1.56%</div></div>
                <div class="index-card"><div class="index-name">æ’ç”ŸæŒ‡æ•°</div><div class="index-val">19,876.54</div><div class="index-down">-0.32%</div></div>
            </div>
        </div>
        
        <!-- Markets -->
        <div class="section">
            <div class="section-title">ğŸ”¥ çƒ­é—¨é¢„æµ‹<span class="market-count" id="marketCount">40 ä¸ªå¸‚åœº</span></div>
            <div class="category-filter">
                <button class="cat-btn active" onclick="filterCategory('all')">ğŸ“Š å…¨éƒ¨</button>
                <button class="cat-btn" onclick="filterCategory('å¤§ç›˜')">ğŸ“ˆ å¤§ç›˜</button>
                <button class="cat-btn" onclick="filterCategory('ä¸ªè‚¡')">ğŸ’¼ ä¸ªè‚¡</button>
                <button class="cat-btn" onclick="filterCategory('æ¿å—')">ğŸ”¥ æ¿å—</button>
                <button class="cat-btn" onclick="filterCategory('æ”¿ç­–')">ğŸ“œ æ”¿ç­–</button>
                <button class="cat-btn" onclick="filterCategory('æ¸¯è‚¡')">ğŸ‡­ğŸ‡° æ¸¯è‚¡</button>
            </div>
            <div class="markets-grid" id="marketsGrid"></div>
        </div>
    </div>
    
    <!-- Bet Modal -->
    <div class="modal-overlay" id="betModal">
        <div class="modal">
            <div class="modal-title" id="betModalTitle">ç¡®è®¤æŠ•æ³¨</div>
            <div style="margin-bottom:15px;color:#888;">
                <div id="betMarketName" style="font-size:16px;margin-bottom:10px;"></div>
                <div id="betDirection" style="font-weight:bold;"></div>
            </div>
            <input type="number" class="modal-input" id="betAmount" placeholder="è¾“å…¥æŠ•æ³¨é‡‘é¢ (BNB)" min="0.001" step="0.001" value="0.1">
            <div style="margin-bottom:15px;font-size:14px;color:#888;">
                é¢„è®¡è·å¾—: <span id="potentialWin" style="color:#ffd700;">0</span> BNB
            </div>
            <div class="modal-btns">
                <button class="modal-btn cancel" onclick="closeBetModal()">å–æ¶ˆ</button>
                <button class="modal-btn confirm" onclick="confirmBet()">ç¡®è®¤æŠ•æ³¨</button>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>ğŸ“Š åŒèŠ±é¡ºé¢„æµ‹å¸‚åœº | ğŸ¯ èµ”ç‡ä»…ä¾›å‚è€ƒ</p>
        <p>åˆçº¦: <a href="https://bscscan.com/address/0x0a622fBE2A3daD19AEEFAb20880E5E7a87d37146" target="_blank">0x0a62...146</a> | BSC Mainnet</p>
    </div>
    
    <script>
    // Config
    const CONFIG = {
        CONTRACT_ADDRESS: "0x0a622fBE2A3daD19AEEFAb20880E5E7a87d37146",
        BSC_CHAIN_ID: "0x38",
        RPC_URL: "https://bsc-dataseed1.binance.org/"
    };
    
    let web3 = null;
    let contract = null;
    let userAccount = null;
    let currentBet = null;
    let currentCategory = 'all';
    
    const CONTRACT_ABI = [{"inputs":[{"name":"_marketId","type":"uint256"},{"name":"_isYes","type":"bool"}],"name":"placeBet","outputs":[],"stateMutability":"payable","type":"function"}];
    
    const marketsData = [
        {id:1,q:"ä¸Šè¯æŒ‡æ•°ä»Šæ—¥æ”¶ç›˜ > 3450 ç‚¹",cat:"å¤§ç›˜",hot:true,yesOdds:1.85,noOdds:2.05,yesPct:55,end:"ä»Šæ—¥"},
        {id:2,q:"åˆ›ä¸šæ¿æŒ‡çªç ´ 2500 ç‚¹",cat:"å¤§ç›˜",hot:true,yesOdds:2.20,noOdds:1.75,yesPct:48,end:"æœ¬å‘¨"},
        {id:3,q:"æ²ªæ·±300ç«™ä¸Š 4200 ç‚¹",cat:"å¤§ç›˜",yesOdds:2.50,noOdds:1.60,yesPct:42,end:"æœ¬æœˆ"},
        {id:4,q:"ä¸Šè¯ 3500 ç‚¹ä¿å«æˆ˜",cat:"å¤§ç›˜",yesOdds:1.55,noOdds:2.45,yesPct:65,end:"æœ¬å‘¨"},
        {id:5,q:"åŒ—å‘èµ„é‡‘å‡€æµå…¥ç™¾äº¿",cat:"å¤§ç›˜",yesOdds:1.85,noOdds:2.00,yesPct:52,end:"ä»Šæ—¥"},
        {id:6,q:"æˆäº¤é‡ç ´ä¸‡äº¿",cat:"å¤§ç›˜",yesOdds:1.60,noOdds:2.40,yesPct:62,end:"ä»Šæ—¥"},
        {id:7,q:"è´µå·èŒ…å°çªç ´ 1800 å…ƒ",cat:"ä¸ªè‚¡",hot:true,yesOdds:1.90,noOdds:2.00,yesPct:52,end:"æœ¬æœˆ"},
        {id:8,q:"å®å¾·æ—¶ä»£é‡å› 400 å…ƒ",cat:"ä¸ªè‚¡",yesOdds:2.30,noOdds:1.70,yesPct:45,end:"æœ¬æœˆ"},
        {id:9,q:"æ¯”äºšè¿ªçªç ´ 300 å…ƒ",cat:"ä¸ªè‚¡",yesOdds:1.75,noOdds:2.15,yesPct:58,end:"æœ¬æœˆ"},
        {id:10,q:"æ‹›å•†é“¶è¡Œåˆ›æ–°é«˜",cat:"ä¸ªè‚¡",yesOdds:2.10,noOdds:1.85,yesPct:50,end:"æœ¬æœˆ"},
        {id:11,q:"ä¸­ä¿¡è¯åˆ¸æ¶¨åœ",cat:"ä¸ªè‚¡",yesOdds:3.50,noOdds:1.35,yesPct:28,end:"æœ¬å‘¨"},
        {id:12,q:"äº”ç²®æ¶²çªç ´ 150 å…ƒ",cat:"ä¸ªè‚¡",yesOdds:2.15,noOdds:1.80,yesPct:48,end:"æœ¬æœˆ"},
        {id:13,q:"äººå·¥æ™ºèƒ½æ¿å—é¢†æ¶¨",cat:"æ¿å—",hot:true,yesOdds:1.65,noOdds:2.30,yesPct:62,end:"æœ¬å‘¨"},
        {id:14,q:"æ–°èƒ½æºè½¦æ¿å—åå¼¹",cat:"æ¿å—",yesOdds:1.95,noOdds:1.95,yesPct:50,end:"æœ¬å‘¨"},
        {id:15,q:"åŠå¯¼ä½“æ¿å—å›è°ƒ",cat:"æ¿å—",yesOdds:2.20,noOdds:1.75,yesPct:45,end:"æœ¬å‘¨"},
        {id:16,q:"ç™½é…’æ¿å—æ­¢è·Œå›å‡",cat:"æ¿å—",yesOdds:2.40,noOdds:1.65,yesPct:40,end:"æœ¬å‘¨"},
        {id:17,q:"åˆ¸å•†æ¿å—å¯åŠ¨",cat:"æ¿å—",hot:true,yesOdds:1.80,noOdds:2.10,yesPct:55,end:"æœ¬å‘¨"},
        {id:18,q:"é“¶è¡Œæ¿å—æŠ¤ç›˜",cat:"æ¿å—",yesOdds:1.65,noOdds:2.35,yesPct:60,end:"æœ¬å‘¨"},
        {id:19,q:"CRO æ¿å—å¤§æ¶¨",cat:"æ¿å—",yesOdds:2.10,noOdds:1.85,yesPct:50,end:"æœ¬å‘¨"},
        {id:20,q:"è¯ç›‘ä¼šå‘å¸ƒåˆ©å¥½æ”¿ç­–",cat:"æ”¿ç­–",hot:true,yesOdds:1.50,noOdds:2.60,yesPct:68,end:"æœ¬æœˆ"},
        {id:21,q:"IPO é‡å¯æé€Ÿ",cat:"æ”¿ç­–",yesOdds:1.80,noOdds:2.10,yesPct:55,end:"æœ¬æœˆ"},
        {id:22,q:"é™æ¯é™å‡†è½åœ°",cat:"æ”¿ç­–",yesOdds:2.80,noOdds:1.45,yesPct:35,end:"å­£åº¦"},
        {id:23,q:"T+0 åˆ¶åº¦å®æ–½",cat:"æ”¿ç­–",yesOdds:4.00,noOdds:1.25,yesPct:22,end:"å¹´å†…"},
        {id:24,q:"ç§‘åˆ›æ¿åšå¸‚å•†è½åœ°",cat:"æ”¿ç­–",yesOdds:1.90,noOdds:1.95,yesPct:52,end:"å­£åº¦"},
        {id:25,q:"å…¨é¢æ³¨å†Œåˆ¶æ¨è¡Œ",cat:"æ”¿ç­–",yesOdds:2.60,noOdds:1.50,yesPct:38,end:"å¹´å†…"},
        {id:26,q:"æ’ç”ŸæŒ‡æ•°çªç ´ 20000",cat:"æ¸¯è‚¡",hot:true,yesOdds:1.70,noOdds:2.20,yesPct:60,end:"æœ¬æœˆ"},
        {id:27,q:"è…¾è®¯æ§è‚¡çªç ´ 400 æ¸¯å¸",cat:"æ¸¯è‚¡",yesOdds:2.00,noOdds:1.90,yesPct:52,end:"æœ¬æœˆ"},
        {id:28,q:"é˜¿é‡Œå·´å·´å›æ¸¯ä¸Šå¸‚",cat:"æ¸¯è‚¡",yesOdds:2.50,noOdds:1.60,yesPct:42,end:"åŠå¹´"},
        {id:29,q:"æ¸¯äº¤æ‰€å…è®¸æ•£æˆ·ä¹°Aè‚¡",cat:"æ¸¯è‚¡",yesOdds:3.00,noOdds:1.40,yesPct:32,end:"å¹´å†…"},
        {id:30,q:"äº¬ä¸œç‰©æµçº³å…¥æ¸¯è‚¡é€š",cat:"æ¸¯è‚¡",yesOdds:2.30,noOdds:1.70,yesPct:45,end:"å­£åº¦"},
        {id:31,q:"æ¸¯å¸æ±‡ç‡ç¨³å®š 7.85",cat:"æ¸¯è‚¡",yesOdds:1.75,noOdds:2.20,yesPct:58,end:"æœ¬æœˆ"},
        {id:32,q:"å¿«æ‰‹çº³å…¥æ’ç”ŸæŒ‡æ•°",cat:"æ¸¯è‚¡",yesOdds:2.40,noOdds:1.65,yesPct:43,end:"åŠå¹´"},
        {id:33,q:"éš†åŸºç»¿èƒ½é‡å› 30 å…ƒ",cat:"ä¸ªè‚¡",yesOdds:2.35,noOdds:1.68,yesPct:44,end:"æœ¬æœˆ"},
        {id:34,q:"è¯æ˜åº·å¾·æ¶¨åœ",cat:"ä¸ªè‚¡",yesOdds:3.20,noOdds:1.38,yesPct:30,end:"æœ¬å‘¨"},
        {id:35,q:"æµ·åº·å¨è§†åˆ›æ–°é«˜",cat:"ä¸ªè‚¡",yesOdds:2.45,noOdds:1.62,yesPct:42,end:"æœ¬æœˆ"},
        {id:36,q:"åœ°äº§æ¿å—æ”¿ç­–åˆ©å¥½",cat:"æ¿å—",yesOdds:2.25,noOdds:1.72,yesPct:46,end:"æœ¬æœˆ"},
        {id:37,q:"å¤–æ±‡é™å‡†å…¬å¸ƒ",cat:"æ”¿ç­–",yesOdds:2.00,noOdds:1.88,yesPct:48,end:"å­£åº¦"},
        {id:38,q:"ç¤¾ä¿åŸºé‡‘åŠ ä»“Aè‚¡",cat:"æ”¿ç­–",yesOdds:1.55,noOdds:2.50,yesPct:65,end:"å­£åº¦"},
        {id:39,q:"é¦™æ¸¯ä¸å†…åœ°é€šå…³æ¢å¤",cat:"æ¸¯è‚¡",yesOdds:1.45,noOdds:2.70,yesPct:70,end:"å¹´å†…"},
        {id:40,q:"ä¸¤èä½™é¢ç ´ 2 ä¸‡äº¿",cat:"å¤§ç›˜",yesOdds:1.70,noOdds:2.25,yesPct:58,end:"æœ¬æœˆ"}
    ];
    
    document.addEventListener('DOMContentLoaded', async () => {
        await initSystem();
        renderMarkets();
    });
    
    async function initSystem() {
        // Check Web3
        if (typeof Web3 === 'undefined') {
            updateStatus('metamaskStatus', 'error', 'Web3 æœªåŠ è½½');
            return;
        }
        
        // Check MetaMask
        if (typeof window.ethereum === 'undefined') {
            if (typeof window.BinanceChain !== 'undefined') {
                window.ethereum = window.BinanceChain;
            }
        }
        
        if (typeof window.ethereum !== 'undefined') {
            updateStatus('metamaskStatus', 'success', 'å·²å®‰è£…');
        } else {
            updateStatus('metamaskStatus', 'warning', 'MetaMask æœªå®‰è£…');
        }
        
        // Init Web3
        web3 = new Web3(window.ethereum || new Web3.providers.HttpProvider(CONFIG.RPC_URL));
        
        // Check network
        try {
            if (window.ethereum) {
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                if (chainId === CONFIG.BSC_CHAIN_ID) {
                    updateStatus('networkStatus', 'success', 'BSC ä¸»ç½‘ âœ“');
                } else {
                    updateStatus('networkStatus', 'warning', 'é BSC');
                }
            } else {
                updateStatus('networkStatus', 'warning', 'ä½¿ç”¨ RPC');
            }
        } catch (e) {
            updateStatus('networkStatus', 'warning', 'ç½‘ç»œæœªçŸ¥');
        }
        
        // Init contract
        try {
            contract = new web3.eth.Contract(CONTRACT_ABI, CONFIG.CONTRACT_ADDRESS);
            const code = await web3.eth.getCode(CONFIG.CONTRACT_ADDRESS);
            if (code && code !== '0x') {
                updateStatus('contractStatus', 'success', 'å·²è¿æ¥ âœ“');
            } else {
                updateStatus('contractStatus', 'error', 'åˆçº¦æœªæ‰¾åˆ°');
            }
        } catch (e) {
            updateStatus('contractStatus', 'error', 'è¿æ¥å¤±è´¥');
        }
        
        // Check connection
        try {
            if (window.ethereum) {
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts.length > 0) {
                    userAccount = accounts[0];
                    await updateWalletUI();
                }
            }
        } catch (e) {}
    }
    
    function updateStatus(id, status, text) {
        const el = document.getElementById(id);
        el.innerHTML = `<span class="status-dot status-${status}"></span>${text}`;
    }
    
    async function connectWallet() {
        try {
            if (!window.ethereum) {
                alert('è¯·å®‰è£… MetaMask!\n\nä¸‹è½½: https://metamask.io/download/');
                return;
            }
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            if (accounts.length > 0) {
                userAccount = accounts[0];
                await updateWalletUI();
                window.ethereum.on('accountsChanged', handleAccountsChanged);
                window.ethereum.on('chainChanged', () => window.location.reload());
                alert('âœ… é’±åŒ…è¿æ¥æˆåŠŸ!\n\n' + userAccount.slice(0,6) + '...' + userAccount.slice(-4));
            }
        } catch (e) {
            alert('è¿æ¥å¤±è´¥: ' + e.message);
        }
    }
    
    function disconnectWallet() {
        userAccount = null;
        document.getElementById('walletInfo').classList.remove('show');
        document.getElementById('connectBtn').style.display = 'block';
        updateStatus('connectionStatus', 'gray', 'æœªè¿æ¥');
    }
    
    function handleAccountsChanged(accounts) {
        if (accounts.length === 0) {
            disconnectWallet();
        } else {
            userAccount = accounts[0];
            updateWalletUI();
        }
    }
    
    async function updateWalletUI() {
        if (!userAccount) return;
        document.getElementById('walletAddr').textContent = userAccount.slice(0,6) + '...' + userAccount.slice(-4);
        try {
            const balance = await web3.eth.getBalance(userAccount);
            document.getElementById('walletBal').textContent = parseFloat(web3.utils.fromWei(balance, 'ether')).toFixed(4) + ' BNB';
        } catch (e) {
            document.getElementById('walletBal').textContent = '0 BNB';
        }
        document.getElementById('walletInfo').classList.add('show');
        document.getElementById('connectBtn').style.display = 'none';
        updateStatus('connectionStatus', 'success', 'å·²è¿æ¥ âœ“');
    }
    
    function renderMarkets() {
        const grid = document.getElementById('marketsGrid');
        const filtered = currentCategory === 'all' ? marketsData : marketsData.filter(m => m.cat === currentCategory);
        document.getElementById('marketCount').textContent = filtered.length + ' ä¸ªå¸‚åœº';
        grid.innerHTML = filtered.map(m => `
            <div class="market-card">
                <div class="card-header">
                    <div class="card-title">${m.q}</div>
                    ${m.hot ? '<span class="hot-tag">ğŸ”¥ çƒ­é—¨</span>' : ''}
                </div>
                <div class="card-meta"><span>ğŸ“Š ${m.cat}</span><span>â±ï¸ ${m.end}</span></div>
                <div class="progress-bar">
                    <div class="progress-yes" style="width: ${m.yesPct}%"></div>
                    <div class="progress-no" style="width: ${100-m.yesPct}%"></div>
                </div>
                <div class="progress-labels">
                    <span style="color:#22bb33">æ¶¨ ${m.yesPct}%</span>
                    <span style="color:#ff4444">è·Œ ${100-m.yesPct}%</span>
                </div>
                <div class="odds-section">
                    <button class="odds-btn odds-up" onclick="openBetModal(${m.id}, true)">
                        <div class="odds-label">ğŸ“ˆ æ¶¨</div>
                        <div class="odds-value">${m.yesOdds}x</div>
                    </button>
                    <button class="odds-btn odds-down" onclick="openBetModal(${m.id}, false)">
                        <div class="odds-label">ğŸ“‰ è·Œ</div>
                        <div class="odds-value">${m.noOdds}x</div>
                    </button>
                </div>
            </div>
        `).join('');
    }
    
    function filterCategory(cat) {
        currentCategory = cat;
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        renderMarkets();
    }
    
    function openBetModal(marketId, isYes) {
        if (!userAccount) {
            alert('è¯·å…ˆè¿æ¥é’±åŒ…!');
            connectWallet();
            return;
        }
        const market = marketsData.find(m => m.id === marketId);
        currentBet = { marketId, isYes, odds: isYes ? market.yesOdds : market.noOdds };
        document.getElementById('betModalTitle').textContent = isYes ? 'ğŸ“ˆ ä¹°æ¶¨' : 'ğŸ“‰ ä¹°è·Œ';
        document.getElementById('betMarketName').textContent = market.q;
        document.getElementById('betDirection').textContent = isYes ? 'ğŸ“ˆ æ¶¨' : 'ğŸ“‰ è·Œ';
        document.getElementById('betDirection').style.color = isYes ? '#22bb33' : '#ff4444';
        document.getElementById('betModal').classList.add('show');
        updatePotentialWin();
    }
    
    function closeBetModal() {
        document.getElementById('betModal').classList.remove('show');
    }
    
    function updatePotentialWin() {
        const amount = parseFloat(document.getElementById('betAmount').value) || 0;
        const win = (amount * currentBet.odds).toFixed(4);
        document.getElementById('potentialWin').textContent = win;
    }
    
    document.getElementById('betAmount').addEventListener('input', updatePotentialWin);
    
    async function confirmBet() {
        const amount = parseFloat(document.getElementById('betAmount').value);
        if (!amount || amount <= 0) {
            alert('è¯·è¾“å…¥æœ‰æ•ˆé‡‘é¢!');
            return;
        }
        
        try {
            const tx = await contract.methods.placeBet(currentBet.marketId, currentBet.isYes).send({
                from: userAccount,
                value: web3.utils.toWei(amount.toString(), 'ether'),
                gas: '300000'
            });
            alert('âœ… æŠ•æ³¨æˆåŠŸ!\n\näº¤æ˜“: ' + tx.transactionHash.slice(0,20) + '...\né‡‘é¢: ' + amount + ' BNB');
            closeBetModal();
        } catch (e) {
            alert('æŠ•æ³¨å¤±è´¥: ' + (e.message || e));
        }
    }
    </script>
</body>
</html>
